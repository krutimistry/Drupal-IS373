<?php
function dbtng_module_practice_entry_insert($entry) {
    $return_value = NULL;
    try {
        $return_value = db_insert('dbtng_example')
            ->fields($entry)
            ->execute();
    }
    catch (Exception $e) {
        drupal_set_message(t('db_insert failed. Message = %message, query= %query',
            array('%message' => $e->getMessage(), '%query' => $e->query_string)), 'error');
    }
    return $return_value;
}

function dbtng_module_practice_entry_update($entry) {
    try {
        // db_update()...->execute() returns the number of rows updated.
        $count = db_update('dbtng_example')
            ->fields($entry)
            ->condition('pid', $entry['pid'])
            ->execute();
    }
    catch (Exception $e) {
        drupal_set_message(t('db_update failed. Message = %message, query= %query',
            array('%message' => $e->getMessage(), '%query' => $e->query_string)), 'error');
    }
    return $count;
}

function dbtng_module_practice_entry_delete($entry) {
    db_delete('dbtng_example')
        ->condition('pid', $entry['pid'])
        ->execute();

}
function dbtng_module_practice_entry_load($entry = array()) {
    // Read all fields from the dbtng_example table.
    $select = db_select('dbtng_example', 'example');
    $select->fields('example');

    // Add each field and value as a condition to this query.
    foreach ($entry as $field => $value) {
        $select->condition($field, $value);
    }
    // Return the result in object format.
    return $select->execute()->fetchAll();
}

function dbtng_example_advanced_list() {
    $output = '';

    $select = db_select('dbtng_example', 'e');

    $select->join('users', 'u', 'e.uid = u.uid');

    $select->addField('e', 'pid');
    $select->addField('u', 'name', 'username');
    $select->addField('e', 'name');
    $select->addField('e', 'surname');
    $select->addField('e', 'age');
    $select->condition('e.name', 'John');
    $select->condition('e.age', 18, '>');
    $select->range(0, 50);
    $entries = $select->execute()->fetchAll(PDO::FETCH_ASSOC);
    if (!empty($entries)) {
        $rows = array();
        foreach ($entries as $entry) {
            $rows[] = array_map('check_plain', $entry);
        }
        $header = array(t('Id'), t('Created by'), t('Name'), t('Surname'), t('Age'));
        $output .= theme('table', array('header' => $header, 'rows' => $rows));
    }
    else {
        drupal_set_message(t('No entries meet the filter criteria (Name = "John" and Age > 18).'));
    }
    return $output;
}